# Projects

Projekte sind Custom Resources von ArgoCD, welche logische Gruppen von Applikationen bilden.
Ein Projekt ist Voraussetzung für Applikationen und muss angegeben werden.

## Wofür werden Projekte benötigt?
- Zugriffsbeschränkungen auf Applikationen
  - CI Pipeline Zugriff geben. Gesichert mit JWT
  - OIDC Gruppen RBAC für Applikationen
- Quellrepositories können eingeschränkt werden
- Ziel-cluster und -namespaces können definiert werden
- White- oder Black-list zum Ausrollen von Cluster- und Namespace-ressourcen

## Wie können Projekte angelegt werden?
- Deklarativ, als YAML
- über die CLI
- In der WebUI

### Argos Default Project
```yaml
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: demo-project
  namespace: argocd
spec:
  sourceRepos:
    - '*'
  destinations:
    - namespace: '*'
      server: '*'
  clusterResourceWhitelist:
    - group: '*'
      kind: '*'
```

AppProject Spezifikation von ArgoCD: https://argo-cd.readthedocs.io/en/stable/operator-manual/project-specification/

# Project Roles

```yaml
  spec:
    ...
    roles:
    # A role which provides read-only access to all applications in the project
    - name: read-only
      description: Read-only privileges to my-project
      policies:
        - p, proj:my-project:read-only, applications, get, my-project/*, allow
      groups:
        - my-oidc-group

    # A role which provides sync privileges to only the guestbook-dev application, e.g. to provide
    # sync privileges to a CI system
    - name: ci-role
      description: Sync privileges for guestbook-dev
      policies:
        - p, proj:my-project:ci-role, applications, sync, my-project/guestbook-dev, allow

      # NOTE: JWT tokens can only be generated by the API server and the token is not persisted
      # anywhere by Argo CD. It can be prematurely revoked by removing the entry from this list.
      jwtTokens:
        - iat: 1535390316
```

Bei den Rollen sind besonders die Policies interessant.
<br>

Syntax im deklarativen Ansatz:

```yaml
  policies:
    - p, proj:<projectname>:<role-name>, applications, <action>, <projectname>/<application-name>, <verb>
```
Policy rules are in the form:
<br>
p, subject, resource, action, object, effect

- subject
  - `user`, `group`, ``
- resource
  - `clusters`, `projects`, `applications`, `applicationsets`, ``repositories``, ``certificates``, ``accounts``, ``gpgkeys``, ``logs``, ``exec``, ``extensions``
- actions
  - ``get``, ``create``, ``update``, ``delete``, ``sync``, ``override``,``action/<group/kind/action-name>``

>Note that sync, override, and action/<group/kind/action-name> only have meaning for the applications resource.

Role definitions and bindings are in the form:
<br>
g, subject, inherited-subject

Erklärungen: https://github.com/argoproj/argo-cd/blob/master/docs/operator-manual/rbac.md